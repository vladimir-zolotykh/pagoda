<!DOCTYPE html>
<html>
    <head>
        <title>Tower of Hanoi</title>
        <style>
         body { font-family: serif; }
         .peg { display: inline-block; width: 120px; vertical-align: top; }
         .disk { border: 1px solid black; margin: 2px; text-align: center; }
        </style>
    </head>
    <body>

        <h1>Tower of Hanoi</h1>

        <div id="board"></div>

        <p>
            <a href="{% url 'reset' %}">Reset</a>
        </p>

        <p>
            Automatic solution using a Python generator.
        </p>

        <script>
         const delay = {{ delay }};
         const board = document.getElementById("board");

         function render(pegs) {
             board.innerHTML = "";
             for (const peg in pegs) {
                 const pegDiv = document.createElement("div");
                 pegDiv.className = "peg";
                 pegDiv.innerHTML = "<strong>Peg " + peg + "</strong>";

                 [...pegs[peg]].reverse().forEach(disk => {
                     const d = document.createElement("div");
                     d.className = "disk";
                     d.textContent = "Disk " + disk;
                     pegDiv.appendChild(d);
                 });

                 board.appendChild(pegDiv);
             }
         }

         function step() {
             fetch("{% url 'step_game' %}")
                 .then(r => r.json())
                 .then(data => {
                     render(data.pegs);

                     if (!data.done) {
                         setTimeout(step, delay);
                     }
                 });
         }

         step();
        </script>

    </body>
</html>
